<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AR Navigation</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text x='0' y='14' font-size='14'>AR</text></svg>">

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- GPS / Location -->
  <script src="https://unpkg.com/aframe-gps-camera/dist/aframe-gps-camera.min.js"></script>
  <script src="https://unpkg.com/aframe-gps-entity-place/dist/aframe-gps-entity-place.min.js"></script>

  <!-- HTML5 QR Scanner -->
  <!-- HTML5 QR Scanner (pinned release) -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <!-- jsQR fallback (pinned) -->
  <script src="https://unpkg.com/jsqr@1.4.0/dist/jsQR.js"></script>

  <!-- Your navigation JS -->
  <script defer src="js/navigation.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    
    /* A-Frame scene - behind everything initially */
    a-scene {
      position: fixed !important;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    #qr-reader {
      position: fixed;
      top: 40px;
      left: 0;
      right: 0;
      bottom: 0;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    #instruction-box {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 10px;
      text-align: center;
      background: #eee;
      font-family: sans-serif;
      z-index: 200;
    }
    /* Tunnel style overlay */
    #qr-tunnel {
      width: 360px; /* narrow pathway */
      height: 60vh;
      border: 4px solid rgba(255,255,255,0.85);
      box-shadow: 0 0 30px rgba(0,0,0,0.7);
      border-radius: 8px;
      display: block;
      background: rgba(0,0,0,0.2);
    }
    /* Scanner container where the camera video will be injected */
    #qr-area {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* Html5Qrcode injects a video and canvas - constrain them */
    #qr-area video, #qr-area canvas {
      width: 100% !important;
      height: 100% !important;
      object-fit: cover;
      transform: translateZ(0);
    }
    #start-scan {
      margin-top: 8px;
      padding: 8px 12px;
    }
  </style>
</head>
<body>

  <div id="instruction-box">Starting cameraâ€¦</div>
  <div id="qr-reader"><div id="qr-tunnel"><div id="qr-area"></div></div></div>
  <div style="text-align:center; position: absolute; top: 56px; left: 0; right:0; pointer-events: none;">
    <button id="start-scan" style="pointer-events: auto;">Start Scanner</button>
  </div>
  
  <!-- Manual QR code input fallback -->
  <div style="position: absolute; top: 100px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.95); padding: 12px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: 1000;">
    <div style="font-family: sans-serif; font-size: 14px; margin-bottom: 8px; color: #333;">
      <strong>Manual Entry</strong> (if scanner fails)
    </div>
    <div style="display: flex; gap: 8px;">
      <input id="manual-input" type="text" placeholder="Enter QR code (e.g. QR001)" 
             style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; flex: 1;">
      <button id="manual-submit" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Submit</button>
    </div>
  </div>
  
  <div id="scan-debug" style="position: absolute; bottom: 8px; left: 8px; right:8px; text-align:center; color:#fff; font-family:monospace; font-size:12px; pointer-events:none;"></div>

  <!-- Fallback video/canvas for jsQR scanning (hidden until used) -->
  <video id="fallback-video" autoplay muted playsinline style="display:none; width:320px; height:480px; object-fit:cover;"></video>
  <canvas id="fallback-canvas" style="display:none;"></canvas>

  <!-- AR Scene -->
<a-scene 
    vr-mode-ui="enabled: false"
    embedded
    renderer="logarithmicDepthBuffer: true">

  <a-camera gps-camera rotation-reader position="0 1.6 0"></a-camera>

  <!-- Sky for visibility -->
  <a-sky color="#87CEEB"></a-sky>
  
  <!-- Ground plane for reference (horizontal) -->
  <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" color="#7BC8A4" material="side: double"></a-plane>
  
  <!-- Test sphere - should be impossible to miss -->
  <a-sphere position="0 1.6 -2" radius="0.5" color="#FF0000"></a-sphere>
  <a-box position="-1 1.6 -3" width="0.5" height="0.5" depth="0.5" color="#00FF00"></a-box>
  <a-box position="1 1.6 -3" width="0.5" height="0.5" depth="0.5" color="#0000FF"></a-box>

  <!-- Assets -->
  <a-assets>
    <a-asset-item 
      id="arrowModel"
      src="assets/arrow.gltf">
    </a-asset-item>
  </a-assets>

  <!-- Arrow entity (initially hidden) -->
  <a-entity id="arrow"
    position="0 1.5 -3"
    scale="0.5 0.5 0.5"
    visible="false">
    <!-- Fallback cone if GLTF doesn't load -->
    <a-cone color="#FF0000" radius-bottom="0.5" radius-top="0" height="2" rotation="0 0 0"></a-cone>
    <a-box color="#FFFF00" position="0 -1.5 0" width="1" height="0.5" depth="0.5"></a-box>
  </a-entity>

</a-scene>

</body>
</html>
